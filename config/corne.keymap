/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/ext_power.h>
#include <dt-bindings/zmk/outputs.h>

/ {
        behaviors {
                hyper: hyper_modifier {
                        compatible = "zmk,behavior-hold-tap";
                        #binding-cells = <2>;
                        flavor = "hold-preferred";
                        tapping-term-ms = <200>;
                        bindings = <&hp>, <&kp>;
                };
        };

        macros {
                win_mode: win_mode {
                        compatible = "zmk,behavior-macro";
                        #binding-cells = <0>;
                        wait-ms = <10>;
                        tap-ms = <10>;
                        bindings = <&bt BT_SEL 0>, <&macro_wait_time 50>, <&to 4>;
                };
                
                mac_mode: mac_mode {
                        compatible = "zmk,behavior-macro";
                        #binding-cells = <0>;
                        wait-ms = <10>;
                        tap-ms = <10>;
                        bindings = <&bt BT_SEL 1>, <&macro_wait_time 50>, <&to 0>;
                };

                hyper: hyper {
                        compatible = "zmk,behavior-macro";
                        #binding-cells = <0>;
                        wait-ms = <10>;
                        tap-ms = <10>;
                        bindings = <&kp LCTRL &kp LALT &kp LGUI>;
                };
        };

        keymap {
                compatible = "zmk,keymap";

                default_layer {

                        bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                        &kp TAB      &kp Q         &kp W        &kp E           &kp R        &kp T               &kp Y        &kp U         &kp I         &kp O         &kp P        &kp BSPC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LSHFT     &kp A         &kp S        &kp D           &kp F        &kp G               &kp H        &kp J         &kp K         &kp L         &kp SEMI     &kp SQT
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LGUI      &kp Z         &kp X        &kp C           &kp V        &kp B               &kp N        &kp M         &kp COMMA     &kp DOT       &kp FSLH     &hyper
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                 &kp LALT       &mo 1      &kp SPACE            &kp RET       &mo 2       &kp RALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };
                lower_layer {

                        bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp ESC    &kp C_VOL_UP     &kp HOME      &kp UP        &kp END       &kp LBRC           &kp RBRC       &kp N7        &kp N8        &kp N9       &kp N0      &kp BSPC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LSHFT   &kp C_MUTE      &kp LEFT     &kp DOWN      &kp RIGHT     &kp LBKT            &kp RBKT       &kp N4        &kp N5        &kp N6      &kp KP_DOT    &kp DEL
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LGUI   &kp C_VOL_DN   &kp C_PREV    &kp C_PP     &kp C_NEXT    &kp LPAR             &kp RPAR       &kp N1        &kp N2        &kp N3      &trans        &hyper
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                  &kp LCTRL      &trans      &kp SPACE           &kp RET        &mo 3       &kp LALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };

                raise_layer {

                        bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp  TAB      &kp EXCL     &kp AT       &kp HASH      &kp DLLR      &kp PRCNT           &kp CARET     &kp AMPS     &kp ASTRK     &kp LPAR      &kp RPAR      &kp BSPC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LSHFT     &kp F1       &kp F2       &kp F3        &kp F4        &kp F5             &kp MINUS     &kp EQUAL     &kp LBKT     &kp RBKT      &kp BSLH      &kp GRAVE
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LGUI      &kp F6       &kp F7       &kp F8        &kp F9        &kp F11            &kp UNDER     &kp PLUS      &kp LBRC     &kp RBRC      &kp PIPE      &kp TILDE
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                 &kp LCTRL      &mo 3       &kp SPACE           &kp RET        &trans      &kp RALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };

                config_layer {

                         bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                     &bt BT_CLR      &trans       &trans         &trans       &trans        &trans              &trans       &trans         &trans       &trans         &trans       &kp PSCRN
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                    &win_mode     &mac_mode     &bt BT_SEL 2  &bt BT_SEL 3  &bt BT_SEL 4    &trans              &trans       &trans         &trans       &trans         &trans       &trans
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                   &ext_power EP_OFF  &trans       &trans         &trans       &trans        &trans             &trans       &trans         &trans       &trans         &trans       &hyper
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                &kp LCTRL      &trans        &kp SPACE           &kp RET      &trans        &kp RALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };

                // WINDOWS LAYERS (4-7)
                win_default_layer {

                        bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                        &kp TAB      &kp Q         &kp W        &kp E           &kp R        &kp T               &kp Y        &kp U         &kp I         &kp O         &kp P        &kp BSPC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LSHFT     &kp A         &kp S        &kp D           &kp F        &kp G               &kp H        &kp J         &kp K         &kp L         &kp SEMI     &kp SQT
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LCTRL     &kp Z         &kp X        &kp C           &kp V        &kp B               &kp N        &kp M         &kp COMMA     &kp DOT       &kp FSLH     &kp ESC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                 &kp LALT       &mo 5      &kp SPACE            &kp RET       &mo 6       &kp RALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };

                win_lower_layer {

                        bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp ESC    &kp C_VOL_UP     &kp HOME      &kp UP        &kp END       &kp LBRC           &kp RBRC       &kp N7        &kp N8        &kp N9       &kp N0      &kp BSPC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LSHFT   &kp C_MUTE      &kp LEFT     &kp DOWN      &kp RIGHT     &kp LBKT            &kp RBKT       &kp N4        &kp N5        &kp N6      &kp KP_DOT    &kp DEL
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LCTRL   &kp C_VOL_DN   &kp C_PREV    &kp C_PP     &kp C_NEXT    &kp LPAR             &kp RPAR       &kp N1        &kp N2        &kp N3      &trans        &trans
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                  &kp LGUI      &trans      &kp SPACE           &kp RET        &mo 7       &kp LALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };

                win_raise_layer {

                        bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp  TAB      &kp EXCL     &kp AT       &kp HASH      &kp DLLR      &kp PRCNT           &kp CARET     &kp AMPS     &kp ASTRK     &kp LPAR      &kp RPAR      &kp BSPC
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LCTRL      &kp F1       &kp F2       &kp F3        &kp F4        &kp F5             &kp MINUS     &kp EQUAL     &kp LBKT     &kp RBKT      &kp BSLH      &kp GRAVE
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                       &kp LSHFT      &kp F6       &kp F7       &kp F8        &kp F9        &kp F11            &kp UNDER     &kp PLUS      &kp LBRC     &kp RBRC      &kp PIPE      &kp TILDE
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                 &kp LGUI      &mo 7       &kp SPACE           &kp RET        &trans      &kp RALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };

                win_config_layer {

                         bindings = <
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                     &bt BT_CLR      &trans       &trans         &trans       &trans        &trans              &trans       &trans         &trans       &trans         &trans       &kp PSCRN
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                    &win_mode     &mac_mode     &bt BT_SEL 2  &bt BT_SEL 3  &bt BT_SEL 4    &trans              &trans       &trans         &trans       &trans         &trans       &trans
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                   &ext_power EP_OFF  &trans       &trans         &trans       &trans        &trans             &trans       &trans         &trans       &trans         &trans       &trans
                                // |-------------+-------------+-------------+-------------+-------------+-----------|      |-------------+-------------+-------------+-------------+-------------+-----------|
                                                                                &kp LGUI      &trans        &kp SPACE           &kp RET      &trans        &kp RALT
                                                                          // |-------------+-------------+-----------|      |-------------+-------------+-----------|
                        >;
                };
        };
};